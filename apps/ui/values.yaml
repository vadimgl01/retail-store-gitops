# ---------------------------------------------------------
# UI CONFIGURATION: retail-store.vadim-devops-teststore.store
# ---------------------------------------------------------
replicaCount: 1

image:
  repository: 630019796862.dkr.ecr.eu-central-1.amazonaws.com/retail-vadim-store-ui
  pullPolicy: Always
  tag: "latest"

imagePullSecrets:
  - name: regcred

serviceAccount:
  create: true
  name: "retail-store-ui-sa"

service:
  type: ClusterIP
  port: 80

# ---------------------------------------------------------
# INGRESS (The Front Door)
# ---------------------------------------------------------
ingress:
  enabled: true
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-body-size: "8m"
    # Connects to the 'certManager' section below
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - retail-store.vadim-devops-teststore.store
  tls:
    - secretName: tls-secret
      hosts:
        - retail-store.vadim-devops-teststore.store

# ---------------------------------------------------------
# APP CONNECTIONS (Connecting to other microservices)
# ---------------------------------------------------------
app:
  endpoints:
    # Assuming your services are named simply 'catalog', 'carts', etc.
    # If connections fail, we might need to change these to 'retail-store-catalog' etc.
    catalog: http://catalog:80
    carts: http://carts:80
    checkout: http://checkout:80
    orders: http://orders:80
  
  # Chat features (Disabled for now)
  chat:
    enabled: false

# ---------------------------------------------------------
# RESOURCES & METRICS
# ---------------------------------------------------------
resources:
  limits:
    memory: 512Mi
  requests:
    cpu: 128m
    memory: 512Mi

metrics:
  enabled: true
  podAnnotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "8080"
    prometheus.io/path: "/actuator/prometheus"

# ---------------------------------------------------------
# CERT MANAGER (Auto-Creates the Issuer!)
# ---------------------------------------------------------
certManager:
  createClusterIssuer: true
  email: vadimglazman@gmail.com           # <--- Your Email
  clusterIssuerName: "letsencrypt-prod"
  server: "https://acme-v02.api.letsencrypt.org/directory"
  privateKeySecretName: "letsencrypt-prod-key"

istio:
  enabled: false

opentelemetry:
  enabled: false

podDisruptionBudget:
  enabled: false

# ---------------------------------------------------------
# AUTOSCALING (Required to fix the crash)
# ---------------------------------------------------------
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
